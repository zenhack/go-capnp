{{with .Annotations.Doc -}}
// {{.}}
{{end -}}
type {{.Node.Name}}{{ template "_declareTypeParams" . }} struct { Client *{{.G.Capnp}}.Client }

{{ template "_typeid" .Node }}

{{range .Methods -}}
func (c {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}) {{.Name|title}}(ctx {{$.G.Imports.Context}}.Context, params func({{$.G.RemoteNodeName .Params $.Node}}) error) ({{$.G.RemoteNodeName .Results $.Node}}_Future, {{$.G.Capnp}}.ReleaseFunc) {
	s := {{$.G.Capnp}}.Send{
		Method: {{$.G.Capnp}}.Method{
			{{template "_interfaceMethod" .}}
		},
	}
	if params != nil {
		s.ArgsSize = {{$.G.ObjectSize .Params}}
		s.PlaceArgs = func(s {{$.G.Capnp}}.Struct) error { return params({{$.G.RemoteNodeName .Params $.Node}}{Struct: s}) }
	}
	ans, release := c.Client.SendCall(ctx, s)
	return {{$.G.RemoteNodeName .Results $.Node}}_Future{Future: ans.Future()}, release
}
{{end}}

func (c {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}) AddRef() {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }} {
	return {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}{
		Client: c.Client.AddRef(),
	}
}

func (c {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}) Release() {
	c.Client.Release()
}

func (c {{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}) EncodeAsPtr(s *{{.G.Capnp}}.Segment) {{.G.Capnp}}.Ptr {
	return c.Client.EncodeAsPtr(s)
}

func (c *{{$.Node.Name}}{{ template "_passTypeParams" $.Node.AllTypeParams }}) DecodeFromPtr(p {{.G.Capnp}}.Ptr) {
	{{.G.Capnp}}.DecodeClientFromPtr(&c.Client, p)
}
